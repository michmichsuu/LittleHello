<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Hello Kuo BaoPay</title>

  <!-- Old-money serif + clean sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;0,600;0,700;1,500;1,600;1,700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-white:#ffffff;
      --bg-cream:#fcfaf7;

      --ink:#2a221d;        /* deep brown-black */
      --muted:#8a8a8a;      /* grey for "You just make me..." */
      --pink:#e88aa8;       /* soft pink (text) */
      --pink-stroke: rgba(232,138,168,.55);  /* line hearts */
      --pink-stroke-strong: rgba(232,138,168,.75);

      --card:#0b0b10;       /* black-ish */
      --card2:#07070b;

      --serif:"Playfair Display", ui-serif, Georgia, "Times New Roman", serif;
      --sans:"Inter", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;

      --radius:26px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--ink);
      background:#000; /* outside the card for question screens */
      overflow-x:hidden;
    }

    /* ===== App frame ===== */
    .app{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px 16px 40px;
      position:relative;
    }

    /* ===== Screen base ===== */
    .screen{
      width:min(920px, 100%);
      border-radius:var(--radius);
      overflow:hidden;
      position:relative;
      display:none;
    }
    .screen.active{ display:block; }

    /* ===== Subtle card glow & border ===== */
    .cardShell{
      width:100%;
      border-radius:var(--radius);
      position:relative;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: radial-gradient(1200px 600px at 20% 10%, rgba(255,255,255,.06), transparent 55%),
                  radial-gradient(1000px 700px at 80% 10%, rgba(232,138,168,.07), transparent 55%),
                  linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      backdrop-filter: blur(8px);
    }

    /* ===== HERO (white) ===== */
    .heroWrap{
      background:var(--bg-white);
      border:1px solid rgba(42,34,29,.08);
    }
    .heroInner{
      padding:54px 28px 44px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      gap:14px;
    }

    .heroBig{
      font-family:var(--serif);
      font-size: clamp(36px, 4.8vw, 56px);
      line-height:1.05;
      letter-spacing:-.6px;
      color:var(--ink);
    }
    .heroBig .rot{
      display:inline-block;
      transition: opacity .22s ease, transform .22s ease;
      will-change: opacity, transform;
    }
    .heroSmall{
      font-family:var(--sans);
      font-size:14px;
      letter-spacing:.02em;
      color:var(--pink); /* a little hello in pink */
    }

    .heroCtaRow{
      margin-top:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:14px;
    }

    .gifChip{
      width:64px; height:64px;
      border-radius:16px;
      background:var(--bg-white); /* match white background */
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
      border:1px solid rgba(42,34,29,.10);
    }
    .gifChip img{
      width:100%; height:100%;
      object-fit:contain;
      display:block;
      background:var(--bg-white);
    }

    .btnStart{
      border:0;
      background:var(--ink);
      color:#fff;
      font-family:var(--sans);
      padding:14px 18px;
      border-radius:999px;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:12px;
      cursor:pointer;
      transition: transform .15s ease, opacity .15s ease;
    }
    .btnStart:active{ transform: scale(.98); }

    /* ===== Questions (black card) ===== */
    .qWrap{
      background: radial-gradient(1100px 600px at 50% -10%, rgba(232,138,168,.12), transparent 55%),
                  radial-gradient(900px 520px at 20% 20%, rgba(255,255,255,.06), transparent 60%),
                  linear-gradient(180deg, var(--card), var(--card2));
      border:1px solid rgba(255,255,255,.10);
    }

    .qInner{
      position:relative;
      padding:56px 26px 54px;
      min-height: 520px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      gap:10px;
    }

    .qTopHeart{
      width:18px; height:18px;
      margin-bottom:6px;
      opacity:.9;
    }
    .qTopHeart svg{
      width:100%; height:100%;
      fill:none;
      stroke: var(--pink-stroke-strong);
      stroke-width:2.2;
      stroke-linecap:round;
      stroke-linejoin:round;
      filter: drop-shadow(0 0 10px rgba(232,138,168,.10));
    }

    .qKicker{
      font-family:var(--sans);
      color:rgba(255,255,255,.55);
      letter-spacing:.18em;
      font-size:11px;
      text-transform:uppercase;
      margin-top:2px;
    }

    .qTitle{
      font-family:var(--serif);
      font-size: clamp(34px, 4.2vw, 54px);
      line-height:1.05;
      letter-spacing:-.6px;
      color:rgba(255,255,255,.92);
      margin:0;
    }

    .qSub{
      font-family:var(--sans);
      font-size:13px;
      color:rgba(255,255,255,.45);
      margin-top:6px;
    }

    .qRow{
      margin-top:26px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:14px;
      flex-wrap:wrap;
    }

    .btnYes{
      border:0;
      background: linear-gradient(135deg, rgba(232,138,168,.92), rgba(255,164,192,.82));
      color:#1d1118;
      font-weight:600;
      padding:14px 22px;
      border-radius:999px;
      cursor:pointer;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:12px;
      min-width:170px;
      box-shadow: 0 8px 30px rgba(232,138,168,.22);
      transition: transform .15s ease;
    }
    .btnYes:active{ transform:scale(.98); }

    .btnAlt{
      background:transparent;
      color:rgba(255,255,255,.68);
      border:1px solid rgba(255,255,255,.22);
      padding:14px 22px;
      border-radius:999px;
      cursor:pointer;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:12px;
      min-width:170px;
      transition: transform .15s ease, border-color .15s ease;
    }
    .btnAlt:active{ transform:scale(.98); }
    .btnAlt:hover{ border-color: rgba(255,255,255,.35); }

    /* Dots */
    .dots{
      position:absolute;
      left:0; right:0;
      bottom:18px;
      display:flex;
      justify-content:center;
      gap:8px;
      opacity:.9;
    }
    .dot{
      width:6px; height:6px;
      border-radius:999px;
      background:rgba(255,255,255,.25);
    }
    .dot.active{
      width:18px;
      background:rgba(232,138,168,.9);
    }

    /* "Are you sure? üò°" */
    .areYouSure{
      position:absolute;
      top:28px;
      left:50%;
      transform:translateX(-50%);
      font-family:var(--sans);
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(255,255,255,.78);
      display:none;
      gap:10px;
      align-items:center;
      user-select:none;
      pointer-events:none;
    }
    .areYouSure .miniHeart{
      width:14px;height:14px;
      opacity:.95;
    }
    .areYouSure .miniHeart svg{
      width:100%;height:100%;
      fill:none;
      stroke: var(--pink-stroke-strong);
      stroke-width:2.2;
      stroke-linecap:round;
      stroke-linejoin:round;
    }
    .areYouSure.show{ display:flex; }

    /* ===== Floating line hearts (watermark background) ===== */
    .wmHearts{
      pointer-events:none;
      position:absolute;
      inset:0;
      overflow:hidden;
      z-index:0;
    }
    .wmHeart{
      position:absolute;
      bottom:-40px;
      opacity:.12;
      filter: blur(.0px);
      animation: floatUp linear forwards;
      will-change: transform, opacity;
    }
    .wmHeart svg{
      width:100%; height:100%;
      fill:none;
      stroke: var(--pink-stroke);
      stroke-width:2.1;
      stroke-linecap:round;
      stroke-linejoin:round;
    }
    @keyframes floatUp{
      0%   { transform: translateY(0) translateX(0) scale(1); opacity:.00; }
      10%  { opacity:.12; }
      80%  { opacity:.12; }
      100% { transform: translateY(-120vh) translateX(var(--drift)) scale(1); opacity:0; }
    }

    /* Put content above watermark */
    .qInner > *{ position:relative; z-index:1; }

    /* ===== Final screen (cream) ===== */
    .finalWrap{
      background: var(--bg-cream);
      border:1px solid rgba(42,34,29,.08);
    }
    .finalInner{
      padding:52px 26px 48px;
      min-height: 520px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      gap:10px;
      position:relative;
      overflow:hidden;
    }

    .finalYaaay{
      font-family:var(--serif);
      font-size: clamp(42px, 5vw, 62px);
      line-height:1;
      letter-spacing:-.6px;
      color: var(--ink); /* deep brown-black */
      margin:0;
    }
    .finalPinkLine{
      font-family:var(--sans);
      font-size:13px;
      letter-spacing:.02em;
      color: var(--pink); /* small line in pink */
      margin-top:6px;
    }
    .finalGreyLine{
      font-family:var(--sans);
      font-size:13px;
      letter-spacing:.01em;
      color: var(--muted); /* requested grey */
      margin-top:2px;
    }

    .finalGifBox{
      width:min(360px, 78vw);
      aspect-ratio: 1 / 1;
      border-radius:22px;
      background: var(--bg-cream); /* match final background */
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border:1px solid rgba(42,34,29,.10);
      margin-top:18px;
    }
    .finalGifBox img{
      width:100%; height:100%;
      object-fit:contain;
      background: var(--bg-cream); /* blend */
      display:block;
    }

    .finalHappy{
      margin-top:18px;
      font-family:var(--serif);
      font-size: clamp(26px, 3.2vw, 42px);
      letter-spacing:-.4px;
      color: var(--pink); /* requested pink */
    }

    /* Confetti (pop / party popper from bottom to top) */
    .confetti{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      display:none;
      z-index:5;
    }
    .confetti.show{ display:block; }
    .confetti i{
      position:absolute;
      bottom:-20px;
      width:10px;
      height:16px;
      border-radius:2px;
      background: rgba(232,138,168,.65);
      animation: popUp 1.8s cubic-bezier(.2,.9,.2,1) forwards;
      transform: translateY(0) rotate(0deg);
      opacity:.0;
    }
    @keyframes popUp{
      0%   { transform: translateY(0) translateX(0) rotate(0deg); opacity:0; }
      10%  { opacity:.95; }
      100% { transform: translateY(-120vh) translateX(var(--dx)) rotate(540deg); opacity:0; }
    }

    /* No button micro pop */
    .no-pop{ transform: scale(1.03); }
    .no-pop{ transition: transform .15s ease; }

    /* Make sure iOS Safari doesn't show weird focus outline */
    button:focus{ outline:none; }

    /* Small helper: keep everything nicely centered on small screens */
    @media (max-width:520px){
      .qInner{ padding:46px 18px 52px; min-height: 540px; }
      .heroInner{ padding:48px 18px 40px; }
      .btnYes,.btnAlt{ min-width: 150px; }
    }
  </style>
</head>

<body>
  <div class="app">

    <!-- Audio (rename your files to match) -->
    <audio id="bgm" src="bgm.mp3" loop preload="auto"></audio>
    <audio id="popSfx" src="pop.mp3" preload="auto"></audio>

    <!-- ========== HERO (Screen 0) ========== -->
    <section class="screen active heroWrap" id="screen-hero">
      <div class="cardShell heroWrap">
        <div class="heroInner">
          <div class="heroBig">
            <span class="rot" id="rotatingHello">Hola Kuo BaoPay</span>
          </div>
          <div class="heroSmall">a little hello</div>

          <div class="heroCtaRow">
            <div class="gifChip" aria-hidden="true">
              <!-- your start gif -->
              <img src="start.gif" alt="start gif" />
            </div>
            <button class="btnStart" id="btnStart">LET‚ÄôS START</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ========== Q1 ========== -->
    <section class="screen qWrap" id="screen-q1">
      <div class="cardShell qWrap">
        <div class="wmHearts" id="wm-q1"></div>

        <div class="qInner">
          <div class="qTopHeart" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <path d="M12 21s-7.2-4.4-9.5-8.4C.7 9.3 2.5 6 6 6c1.8 0 3.1 1 4 2.1C10.9 7 12.2 6 14 6c3.5 0 5.3 3.3 3.5 6.6C19.2 16.6 12 21 12 21z"/>
            </svg>
          </div>

          <div class="qKicker">01</div>
          <h1 class="qTitle">Do you like spending time<br/>with me?</h1>
          <div class="qSub">be honest...</div>

          <div class="qRow">
            <button class="btnYes" id="q1Yes">YES ‚ô°</button>
            <button class="btnAlt" id="q1Alt">ABSOLUTELY</button>
          </div>

          <div class="dots" aria-hidden="true">
            <span class="dot active"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- ========== Q2 ========== -->
    <section class="screen qWrap" id="screen-q2">
      <div class="cardShell qWrap">
        <div class="wmHearts" id="wm-q2"></div>

        <div class="qInner">
          <div class="qTopHeart" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <path d="M12 21s-7.2-4.4-9.5-8.4C.7 9.3 2.5 6 6 6c1.8 0 3.1 1 4 2.1C10.9 7 12.2 6 14 6c3.5 0 5.3 3.3 3.5 6.6C19.2 16.6 12 21 12 21z"/>
            </svg>
          </div>

          <div class="qKicker">02</div>
          <h1 class="qTitle">Do you think about me<br/>when we‚Äôre apart?</h1>
          <div class="qSub">even a little?</div>

          <div class="qRow">
            <button class="btnYes" id="q2Yes">YES ‚ô°</button>
            <button class="btnAlt" id="q2Alt">ABSOLUTELY</button>
          </div>

          <div class="dots" aria-hidden="true">
            <span class="dot"></span><span class="dot active"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- ========== Q3 ========== -->
    <section class="screen qWrap" id="screen-q3">
      <div class="cardShell qWrap">
        <div class="wmHearts" id="wm-q3"></div>

        <div class="qInner">
          <div class="qTopHeart" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <path d="M12 21s-7.2-4.4-9.5-8.4C.7 9.3 2.5 6 6 6c1.8 0 3.1 1 4 2.1C10.9 7 12.2 6 14 6c3.5 0 5.3 3.3 3.5 6.6C19.2 16.6 12 21 12 21z"/>
            </svg>
          </div>

          <div class="qKicker">03</div>
          <h1 class="qTitle">Do you smile when you see<br/>my name on your phone?</h1>
          <div class="qSub">because I smile when I see yours...</div>

          <div class="qRow">
            <button class="btnYes" id="q3Yes">YES ‚ô°</button>
            <button class="btnAlt" id="q3Alt">ABSOLUTELY</button>
          </div>

          <div class="dots" aria-hidden="true">
            <span class="dot"></span><span class="dot"></span><span class="dot active"></span><span class="dot"></span><span class="dot"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- ========== Q4 (Runaway NO) ========== -->
    <section class="screen qWrap" id="screen-q4">
      <div class="cardShell qWrap">
        <div class="wmHearts" id="wm-q4"></div>

        <div class="areYouSure" id="areYouSure">
          <span class="miniHeart" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <path d="M12 21s-7.2-4.4-9.5-8.4C.7 9.3 2.5 6 6 6c1.8 0 3.1 1 4 2.1C10.9 7 12.2 6 14 6c3.5 0 5.3 3.3 3.5 6.6C19.2 16.6 12 21 12 21z"/>
            </svg>
          </span>
          <span>ARE YOU SURE? üò°</span>
        </div>

        <div class="qInner">
          <div class="qTopHeart" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <path d="M12 21s-7.2-4.4-9.5-8.4C.7 9.3 2.5 6 6 6c1.8 0 3.1 1 4 2.1C10.9 7 12.2 6 14 6c3.5 0 5.3 3.3 3.5 6.6C19.2 16.6 12 21 12 21z"/>
            </svg>
          </div>

          <div class="qKicker">THE REAL QUESTION</div>
          <h1 class="qTitle">Will you be<br/><span style="color:rgba(232,138,168,.92)">my Valentine?</span></h1>
          <div class="qSub">i‚Äôve been waiting to ask you this...</div>

          <div class="qRow" id="q4Row">
            <button class="btnYes" id="finalYes">YES, I‚ÄôD LOVE TO ‚ô°</button>
            <button class="btnAlt" id="finalNo">NO</button>
          </div>

          <div class="dots" aria-hidden="true">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot active"></span><span class="dot"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- ========== FINAL ========== -->
    <section class="screen finalWrap" id="screen-final">
      <div class="cardShell finalWrap">
        <div class="confetti" id="confetti"></div>

        <div class="finalInner">
          <h1 class="finalYaaay" id="yaaaayTitle">Yaaay!</h1>

          <div class="finalPinkLine">I knew you‚Äôd say yes!</div>
          <div class="finalGreyLine">You just made me the happiest person in the world</div>

          <div class="finalGifBox">
            <!-- your kiss gif -->
            <img src="kiss.gif.gif" alt="kissing gif" />
          </div>

          <div class="finalHappy">Happy Valentine‚Äôs and 18th</div>

          <div class="dots" aria-hidden="true">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot active"></span>
          </div>
        </div>
      </div>
    </section>

  </div>

  <script>
    // ====== Helpers ======
    function show(id){
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");

      // stop runaway if not on q4
      if(id !== "screen-q4"){
        stopAutoRunaway();
      }
    }

    // ====== Apple-style rotating hello ======
    const rotatingHello = document.getElementById("rotatingHello");
    const hellos = [
      "Hola Kuo BaoPay",
      "Bonjour Kuo BaoPay",
      "‰Ω†Â•Ω Kuo BaoPay",
      "„Åì„Çì„Å´„Å°„ÅØ Kuo BaoPay",
      "ÂìàÂõâ Kuo BaoPay"
    ];
    let hiIdx = 0;

    setInterval(() => {
      hiIdx = (hiIdx + 1) % hellos.length;
      rotatingHello.style.opacity = 0;
      rotatingHello.style.transform = "translateY(2px)";
      setTimeout(() => {
        rotatingHello.textContent = hellos[hiIdx];
        rotatingHello.style.opacity = 1;
        rotatingHello.style.transform = "translateY(0)";
      }, 220);
    }, 1400);

    // ====== Background line-heart watermark generator ======
    function heartSVG(){
      return `
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 21s-7.2-4.4-9.5-8.4C.7 9.3 2.5 6 6 6c1.8 0 3.1 1 4 2.1C10.9 7 12.2 6 14 6c3.5 0 5.3 3.3 3.5 6.6C19.2 16.6 12 21 12 21z"/>
        </svg>`;
    }

    function spawnHeart(container){
      const el = document.createElement("div");
      el.className = "wmHeart";
      el.innerHTML = heartSVG();

      const size = 10 + Math.random()*18; // 10-28px
      el.style.width = size + "px";
      el.style.height = size + "px";
      el.style.left = (Math.random()*100) + "%";
      el.style.opacity = 0.08 + Math.random()*0.10;

      const dur = 10 + Math.random()*12; // 10-22s
      el.style.animationDuration = dur + "s";

      const drift = (Math.random() < 0.5 ? -1 : 1) * (10 + Math.random()*30);
      el.style.setProperty("--drift", drift + "px");

      container.appendChild(el);

      // cleanup
      setTimeout(() => el.remove(), (dur+1)*1000);
    }

    function startHearts(containerId){
      const c = document.getElementById(containerId);
      if(!c) return;
      // seed a few
      for(let i=0;i<10;i++){
        setTimeout(() => spawnHeart(c), i*350);
      }
      // keep spawning slowly
      setInterval(() => spawnHeart(c), 650);
    }

    ["wm-q1","wm-q2","wm-q3","wm-q4"].forEach(startHearts);

    // ====== Audio ======
    const bgm = document.getElementById("bgm");
    const popSfx = document.getElementById("popSfx");

    function safePlay(audioEl){
      if(!audioEl) return;
      audioEl.volume = 0.85;
      const p = audioEl.play();
      if(p && typeof p.catch === "function") p.catch(()=>{});
    }

    // Start flow
    document.getElementById("btnStart").addEventListener("click", () => {
      // Start BGM after user gesture (iOS safe)
      safePlay(bgm);
      show("screen-q1");
    });

    // ====== Q navigation ======
    function goNext(current){
      const order = ["screen-q1","screen-q2","screen-q3","screen-q4","screen-final"];
      const idx = order.indexOf(current);
      if(idx >= 0 && idx < order.length-1) show(order[idx+1]);
    }

    // Q1
    document.getElementById("q1Yes").addEventListener("click", ()=>goNext("screen-q1"));
    document.getElementById("q1Alt").addEventListener("click", ()=>goNext("screen-q1"));

    // Q2
    document.getElementById("q2Yes").addEventListener("click", ()=>goNext("screen-q2"));
    document.getElementById("q2Alt").addEventListener("click", ()=>goNext("screen-q2"));

    // Q3
    document.getElementById("q3Yes").addEventListener("click", ()=>goNext("screen-q3"));
    document.getElementById("q3Alt").addEventListener("click", ()=>goNext("screen-q3"));

    // ====== Q4 runaway NO (always visible, auto-run in safe zone) ======
    const finalNo = document.getElementById("finalNo");
    const areYouSure = document.getElementById("areYouSure");

    let runawayEnabled = false;
    let runawayTimer = null;
    let runawayCooldown = false;

    function isOnQ4(){
      return document.getElementById("screen-q4").classList.contains("active");
    }

    function enableRunaway(){
      if(runawayEnabled) return;
      runawayEnabled = true;

      // float above UI but still clickable
      finalNo.style.position = "fixed";
      finalNo.style.zIndex = "60";
      finalNo.style.display = "inline-flex";
      finalNo.style.visibility = "visible";

      // start near YES
      const yesRect = document.getElementById("finalYes").getBoundingClientRect();
      finalNo.style.left = (yesRect.right + 14) + "px";
      finalNo.style.top  = (yesRect.top + 2) + "px";

      // start auto-run after a short pause
      setTimeout(() => startAutoRunaway(), 900);
    }

    function startAutoRunaway(){
      stopAutoRunaway();
      runawayTimer = setInterval(() => {
        if(!isOnQ4() || !runawayEnabled) return;
        moveNo(true);
      }, 950);
    }

    function stopAutoRunaway(){
      if(runawayTimer){
        clearInterval(runawayTimer);
        runawayTimer = null;
      }
    }

    function moveNo(isAuto=false){
      if(!isOnQ4()) return;

      const padding = 16;

      const q4 = document.getElementById("screen-q4");
      const row = q4.querySelector("#q4Row");
      const rowRect = row.getBoundingClientRect();
      const b = finalNo.getBoundingClientRect();

      const minX = padding;
      const maxX = Math.max(minX, window.innerWidth - b.width - padding);

      // SAFE ZONE: from button row top to bottom (so it never overlaps title/subtitle)
      const minY = Math.max(padding, Math.floor(rowRect.top - 8));
      const maxY = Math.max(minY, window.innerHeight - b.height - 70);

      const x = minX + Math.random() * (maxX - minX);
      const y = minY + Math.random() * (maxY - minY);

      finalNo.style.left = x + "px";
      finalNo.style.top  = y + "px";

      areYouSure.classList.add("show");
      setTimeout(() => areYouSure.classList.remove("show"), isAuto ? 520 : 850);

      finalNo.classList.add("no-pop");
      setTimeout(() => finalNo.classList.remove("no-pop"), 170);
    }

    // NO runs away on any interaction, but never disappears
    function tryMove(e){
      if(!isOnQ4()) return;
      if(!runawayEnabled) enableRunaway();

      if(runawayCooldown) return;
      runawayCooldown = true;
      setTimeout(() => runawayCooldown = false, 180);

      moveNo(false);
    }

    finalNo.addEventListener("click", (e) => { e.preventDefault?.(); tryMove(e); });
    finalNo.addEventListener("touchstart", (e) => { e.preventDefault?.(); tryMove(e); }, { passive:false });
    finalNo.addEventListener("mouseenter", tryMove);
    finalNo.addEventListener("mousemove", tryMove);

    window.addEventListener("resize", () => {
      if(!isOnQ4() || !runawayEnabled) return;
      moveNo(true);
    });

    // Enter Q4: NO should first appear beside YES, then start running
    const q4EnterObserver = new MutationObserver(() => {
      if(isOnQ4()){
        // reset positioning each time you enter
        runawayEnabled = false;
        stopAutoRunaway();
        finalNo.style.position = "static";
        finalNo.style.left = "";
        finalNo.style.top = "";
        finalNo.style.zIndex = "";
        finalNo.style.visibility = "visible";
        finalNo.style.display = "inline-flex";

        // enable runaway (auto after 0.9s)
        enableRunaway();
      }
    });
    q4EnterObserver.observe(document.getElementById("screen-q4"), { attributes:true, attributeFilter:["class"] });

    // YES on Q4 -> Final + pop + confetti
    document.getElementById("finalYes").addEventListener("click", () => {
      show("screen-final");
      // pop sound at "Yaaay!"
      safePlay(popSfx);
      // confetti (slower, from bottom to top: party popper ÎäêÎÇå)
      launchConfetti();
    });

    // ====== Confetti (from bottom upward, slightly slower) ======
    const confetti = document.getElementById("confetti");
    function launchConfetti(){
      confetti.innerHTML = "";
      confetti.classList.add("show");

      const pieces = 70;
      for(let i=0;i<pieces;i++){
        const p = document.createElement("i");
        const x = Math.random()*100;   // vw
        const dx = (Math.random()<.5?-1:1) * (20 + Math.random()*140); // sideways drift
        const w = 6 + Math.random()*8;
        const h = 10 + Math.random()*18;

        p.style.left = x + "vw";
        p.style.setProperty("--dx", dx + "px");
        p.style.width = w + "px";
        p.style.height = h + "px";
        p.style.animationDelay = (Math.random()*0.35) + "s";
        p.style.opacity = "0";

        // gentle variety (still pink family)
        const alpha = 0.35 + Math.random()*0.40;
        p.style.background = `rgba(232,138,168,${alpha})`;

        confetti.appendChild(p);
      }

      // hide after
      setTimeout(() => confetti.classList.remove("show"), 2400);
    }
  </script>
</body>
</html>
